<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Changelog</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        dark: {
                            900: '#0D1117',
                            800: '#161B22',
                            700: '#21262D',
                            600: '#30363D',
                            500: '#484F58',
                        },
                        github: {
                            blue: '#58A6FF',
                            green: '#3FB950',
                            purple: '#BC8CFF',
                            red: '#FF7B72',
                            orange: '#FFA657',
                        }
                    },
                    fontFamily: {
                        mono: ['SFMono-Regular', 'Menlo', 'Monaco', 'Consolas', 'Liberation Mono', 'Courier New', 'monospace']
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .disabled-item {
                @apply opacity-50 grayscale-[80%];
            }
            .version-badge {
                @apply text-xs font-mono px-2 py-1 rounded bg-dark-700 text-github-blue border border-dark-600;
            }
            .category-badge {
                @apply text-xs px-2 py-1 rounded font-medium;
            }
            .frontend-badge {
                @apply bg-purple-900/20 text-github-purple border border-dark-600;
            }
            .backend-badge {
                @apply bg-blue-900/20 text-github-blue border border-dark-600;
            }
            .fullstack-badge {
                @apply bg-indigo-900/20 text-indigo-300 border border-dark-600;
            }
            .status-badge {
                @apply text-xs px-2 py-1 rounded font-medium;
            }
            .timeline-line {
                @apply absolute left-[7px] top-5 bottom-0 w-px bg-dark-600;
            }
        }
    </style>
</head>
<body class="bg-dark-900 text-gray-300 min-h-screen font-sans">
    <div class="--max-w-6xl mx-auto">
        <!-- GitHub-like header -->
        <div class="sticky top-0 z-50 bg-dark-800 border-b border-dark-700">
            <div class="px-6 py-4 flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="flex items-center">
                        <i class="fas fa-code-branch text-github-blue mr-2"></i>
                        <h1 class="text-xl font-bold text-white">Project Changelog</h1>
                    </div>
                  
                </div>
                <div class="flex items-center space-x-3">
                    <div id="headerStats" class="flex items-center space-x-4">
                        <span class="text-sm font-mono bg-dark-700 px-3 py-1 rounded-full border border-dark-600">
                            <i class="fas fa-tag text-github-blue mr-1"></i>
                            <span id="currentVersion">v0.0.0</span>
                        </span>
                        <span id="bugCount" class="hidden text-sm font-mono bg-dark-700 px-3 py-1 rounded-full border border-dark-600">
                            <i class="fas fa-bug text-github-orange mr-1"></i>
                            <span id="activeBugs">0</span> open
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main content -->
        <div class="px-6 py-4">
            <!-- Stats bar -->
            <div class="bg-dark-800 border border-dark-700 rounded-lg p-4 mb-6">
                <div class="flex flex-wrap items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <div class="flex items-center">
                            <i class="fas fa-history text-github-blue mr-2"></i>
                            <span class="text-sm">Latest update: <span id="lastUpdateDate" class="font-medium">Loading...</span></span>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-code-commit text-github-green mr-2"></i>
                            <span class="text-sm">Total entries: <span id="totalEntries" class="font-medium">0</span></span>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2 mt-2 sm:mt-0">
                        <div class="h-3 w-3 rounded-full bg-github-green"></div>
                        <span class="text-xs">Fixed: <span id="fixCount">0</span></span>
                        <div class="h-3 w-3 rounded-full bg-github-orange"></div>
                        <span class="text-xs">Bugs: <span id="bugCountNum">0</span></span>
                        <div class="h-3 w-3 rounded-full bg-github-red"></div>
                        <span class="text-xs">Dead: <span id="deadCount">0</span></span>
                    </div>
                </div>
            </div>

            <!-- Changelog container -->
            <div class="relative" id="changelogContainer">
                <!-- Loading state -->
                <div class="text-center py-8" id="loadingState">
                    <div class="inline-flex items-center space-x-2 text-gray-400">
                        <svg class="animate-spin h-5 w-5 text-github-blue" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <span>Loading changelog...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Parse changelog text into structured data
        function parseChangelog(text) {
            const lines = text.split('\n').filter(line => line.trim() !== '');
            const entries = [];
            let deadFoundAt = -1;
            
            // First pass to find the dead entry position
            for (let i = 0; i < lines.length; i++) {
                if (lines[i].includes('[dead]')) {
                    deadFoundAt = i;
                    break;
                }
            }
            
            lines.forEach((line, index) => {
                // Extract date
                const dateMatch = line.match(/^(\d{4}\.\d{2}\.\d{2})/);
                if (!dateMatch) return;
                
                const date = dateMatch[1];
                let remaining = line.slice(dateMatch[0].length).trim();
                
                // Extract status
                let status = null;
                const statusMatch = remaining.match(/\[(dead|bug|fix)\]/i);
                if (statusMatch) {
                    status = statusMatch[1].toLowerCase();
                    remaining = remaining.replace(statusMatch[0], '').trim();
                }
                
                // Extract version
                let version = null;
                const versionMatch = remaining.match(/\[(v\d+\.\d+\.\d+)\]/i);
                if (versionMatch) {
                    version = versionMatch[1];
                    remaining = remaining.replace(versionMatch[0], '').trim();
                }
                
                // Split description and category
                const dashSplit = remaining.split(' - ');
                const description = dashSplit[0] || '';
                const category = dashSplit[1] || '';
                
                entries.push({
                    date,
                    text: description,
                    category: category.trim(),
                    status,
                    version,
                    isDisabled: deadFoundAt >= 0 && index <= deadFoundAt // Disable dead entry and all before it
                });
            });
            
            return entries;
        }
        
        // Format date to more readable format
        function formatDate(dateStr) {
            return dayjs(dateStr.replace(/\./g, '-')).format('MMM D, YYYY');
        }
        
        // Get appropriate icon for status
        function getStatusIcon(status) {
            if (status === 'bug') {
                return `<i class="fas fa-bug text-github-orange"></i>`;
            } else if (status === 'fix') {
                return `<i class="fas fa-check text-github-green"></i>`;
            } else if (status === 'dead') {
                return `<i class="fas fa-skull text-github-red"></i>`;
            } else {
                return `<i class="fas fa-tools text-github-blue"></i>`;
            }
        }
        
        // Get status color class
        function getStatusColor(status) {
            if (status === 'bug') {
                return 'bg-dark-700 text-github-orange border border-dark-600';
            } else if (status === 'fix') {
                return 'bg-dark-700 text-github-green border border-dark-600';
            } else if (status === 'dead') {
                return 'bg-dark-700 text-github-red border border-dark-600';
            } else {
                return 'bg-dark-700 text-github-blue border border-dark-600';
            }
        }
        
        // Update header and stats with changelog data
        function updateStats(entries) {
            // Count bugs, fixes and dead entries
            let bugCount = 0;
            let fixCount = 0;
            let deadCount = 0;
            const versions = new Set();
            let lastUpdateDate = null;
            
            entries.forEach(entry => {
                if (entry.status === 'bug') bugCount++;
                if (entry.status === 'fix') fixCount++;
                if (entry.status === 'dead') deadCount++;
                if (entry.version) versions.add(entry.version);
                if (!lastUpdateDate || entry.date > lastUpdateDate) {
                    lastUpdateDate = entry.date;
                }
            });
            
            // Calculate active bugs (bugs - fixes)
            const activeBugs = Math.max(0, bugCount - fixCount);
            
            // Get latest version
            let latestVersion = 'v0.0.0';
            if (versions.size > 0) {
                const sortedVersions = Array.from(versions).sort((a, b) => {
                    const aParts = a.slice(1).split('.').map(Number);
                    const bParts = b.slice(1).split('.').map(Number);
                    for (let i = 0; i < 3; i++) {
                        if (aParts[i] !== bParts[i]) return bParts[i] - aParts[i];
                    }
                    return 0;
                });
                latestVersion = sortedVersions[0];
            }
            
            // Update header
            document.getElementById('currentVersion').textContent = latestVersion;
            
            // Update bug count
            const bugCountElement = document.getElementById('bugCount');
            if (activeBugs > 0) {
                document.getElementById('activeBugs').textContent = activeBugs;
                bugCountElement.classList.remove('hidden');
            } else {
                bugCountElement.classList.add('hidden');
            }
            
            // Update stats bar
            if (lastUpdateDate) {
                document.getElementById('lastUpdateDate').textContent = formatDate(lastUpdateDate);
            }
            document.getElementById('totalEntries').textContent = entries.length;
            document.getElementById('fixCount').textContent = fixCount;
            document.getElementById('bugCountNum').textContent = bugCount;
            document.getElementById('deadCount').textContent = deadCount;
        }
        
        // Render changelog entries
        function renderChangelog(entries) {
            const container = document.getElementById('changelogContainer');
            container.innerHTML = '';
            
            // Update stats first
            updateStats(entries);
            
            if (entries.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <p class="mt-2">No changelog entries found</p>
                    </div>
                `;
                return;
            }
            
            // Create timeline container
            const timelineEl = document.createElement('div');
            timelineEl.className = 'relative';
            
            entries.forEach((entry, index) => {
                // Create item container
                const itemEl = document.createElement('div');
                itemEl.className = `relative pl-8 pb-6 ${entry.isDisabled ? 'disabled-item' : ''}`;
                
                // Add timeline line
                if (index < entries.length - 1) {
                    const lineEl = document.createElement('div');
                    lineEl.className = 'timeline-line';
                    itemEl.appendChild(lineEl);
                }
                
                // Timeline icon
                const iconEl = document.createElement('div');
                iconEl.className = `absolute left-0 top-1 h-4 w-4 flex items-center justify-center bg-transparent ${
                    entry.status === 'bug' ? 'border-github-orange' :
                    entry.status === 'fix' ? 'border-github-green' :
                    entry.status === 'dead' ? 'border-github-red' :
                    'border-github-blue'
                }`;
                iconEl.innerHTML = getStatusIcon(entry.status);
                itemEl.appendChild(iconEl);
                
                // Content container
                const contentEl = document.createElement('div');
                contentEl.className = 'bg-dark-800 border border-dark-700 rounded-lg p-4 hover:border-dark-600 transition-colors';
                
                // Main content line (description + date + badges)
                const mainContentEl = document.createElement('div');
                mainContentEl.className = 'flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 mb-2';
                
                // Description text
                const textEl = document.createElement('p');
                textEl.className = 'text-white';
                textEl.textContent = entry.text;
                mainContentEl.appendChild(textEl);
                
                // Date
                const dateEl = document.createElement('span');
                dateEl.className = 'text-xs text-gray-400 font-mono whitespace-nowrap';
                dateEl.textContent = formatDate(entry.date);
                mainContentEl.appendChild(dateEl);
                
                contentEl.appendChild(mainContentEl);
                
                // Meta info (category + version + status)
                const metaEl = document.createElement('div');
                metaEl.className = 'flex flex-wrap gap-2 items-center pt-2 border-t border-dark-700 mt-2';
                
                // Category badge
                if (entry.category) {
                    const categoryEl = document.createElement('span');
                    categoryEl.className = `category-badge ${
                        entry.category.toLowerCase() === 'frontend' ? 'frontend-badge' :
                        entry.category.toLowerCase() === 'backend' ? 'backend-badge' :
                        'fullstack-badge'
                    }`;
                    categoryEl.textContent = entry.category;
                    metaEl.appendChild(categoryEl);
                }
                
                // Version badge
                if (entry.version) {
                    const versionEl = document.createElement('span');
                    versionEl.className = 'version-badge';
                    versionEl.textContent = entry.version;
                    metaEl.appendChild(versionEl);
                }
                
                // Status badge
                if (entry.status) {
                    const statusEl = document.createElement('span');
                    statusEl.className = `status-badge ${getStatusColor(entry.status)}`;
                    statusEl.textContent = entry.status;
                    metaEl.appendChild(statusEl);
                }
                
                contentEl.appendChild(metaEl);
                itemEl.appendChild(contentEl);
                timelineEl.appendChild(itemEl);
            });
            
            container.appendChild(timelineEl);
        }
        
        // Fetch and process changelog.txt
        async function loadChangelog() {
            try {
                const response = await fetch('changelog.txt');
                if (!response.ok) throw new Error('Failed to load changelog');
                
                const text = await response.text();
                const entries = parseChangelog(text);
                renderChangelog(entries);
            } catch (error) {
                console.error('Error loading changelog:', error);
                document.getElementById('changelogContainer').innerHTML = `
                    <div class="text-center py-8 text-github-red">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                        </svg>
                        <p class="mt-2">Failed to load changelog</p>
                        <p class="text-sm text-gray-500 mt-1">${error.message}</p>
                    </div>
                `;
                document.getElementById('currentVersion').textContent = 'Error';
            }
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', loadChangelog);
    </script>
</body>
</html>